#!/bin/bash
set -ex

source ./common
init_test_repo
cd $test_repo_path

git clone https://github.com/cplee/github-actions-demo.git

cd github-actions-demo
export PHONY_SECRET=foo

# delete any containers that might exist
docker rm $(docker ps -aq) || true

dry_num_lines=$(popper run --dry-run | grep 'DRYRUN' | wc -l)

# 5 actions, 3 lines per action
test 15 -eq $dry_num_lines

# test that no containers are running
test -z "$(docker ps -aq)"
