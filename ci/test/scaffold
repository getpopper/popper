#!/bin/bash
set -ex

source ./common
init_test_repo
cd $test_repo_path

function check_file(){
    if [ -e $1 ]
then
    echo "Success ! $1 was present"
else
    exit 1
fi

}

popper init

popper scaffold
check_file $test_repo_path/main.workflow
check_file $test_repo_path/actions/example/Dockerfile
check_file $test_repo_path/actions/example/entrypoint.sh
check_file $test_repo_path/actions/example/README.md

rm main.workflow

mkdir pipelines
cd pipelines
mkdir mypipe
cd mypipe

popper scaffold
check_file $test_repo_path/main.workflow
check_file $test_repo_path/pipelines/mypipe/actions/example/Dockerfile
check_file $test_repo_path/pipelines/mypipe/actions/example/entrypoint.sh
check_file $test_repo_path/pipelines/mypipe/actions/example/README.md
